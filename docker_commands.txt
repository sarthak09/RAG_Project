################## 1. DOCKER BUILD 

#Build Docker Image or rebuilt
docker build -t rag_project .

# to verify image created and get image ID
docker images

# to remove images
docker rmi <ID image>




################## 2. DOCKER RUN
#run
docker run -d --name rag_project -p 5000:5000 --env-file .env rag_project
"""
-d = runs in background
-p 5000:5000 = maps port 5000 (access via localhost:5000)
--env-file = loads your API keys
--name = names container "anime-app"
"""

# check docker running containers
docker ps

# check docker all containers
docker ps -a

# check logs
docker logs rag_project

#inspect docker
docker inspect rag_project --format '{{json .Mounts}}'

#stop docker container and remove the container
docker stop rag_project && docker rm rag_project

#stop all running containers
docker stop $(docker ps -q)

#remove all containers 
docker rm -f $(docker ps -aq)

#restart docker container
docker restart rag_project


###################
docker-compose up -d
docker-compose ps
docker-compose logs -f

docker-compose down
docker-compose build
docker-compose up -d


docker-compose ps
docker-compose logs


##############################




github
git checkout -b my-new-branch

git add .
git commit -m "Write a clear commit message here"

git push -u origin my-new-branch

git first push






#minikube
#Check Cluster Status
minikube status

#start minikube
minikube start

# stop minikube
minikube stop


# get cluster info
kubectl cluster-info

# get all nodes
kubectl get nodes
kubectl get pods
kubectl describr pods
kubectl get deployments
kubectl get services
kubectl get secrets
kubectl describe secret llmops-secrets


kubectl apply -f k8.yaml
minikube service llmops-service

kubectl get pods
kubectl get svc llmops-service

kubectl delete -f k8s.yaml
kubectl apply -f k8s.yaml

kubectl get nodes
eval $(minikube docker-env)
kubectl apply -f k8s.yaml
kubectl get pods

#to see service and note hte ports
kubectl get svc

kubectl logs -f planner-6c779d96d-gfpf9
kubectl delete pod -l app=planner
kubectl get pods -w

kubectl get sv
kubectl get svc
kubectl get ns
kubectl create namespace logging
kubectl get pods -n logging



################################################################################
Sequence after making chnages to the code
eval $(minikube docker-env)
docker build --no-cache -t planner:latest .
kubectl delete pod -l app=planner
kubectl get pods  #wait for it to be in running state

kubectl get pods

kubectl logs -l app=planner -f

# keep running this forever
kubectl port-forward svc/planner-service 5000:80 --address 0.0.0.0  

POD_NAME=$(kubectl get pods -l app=planner -o jsonpath='{.items[0].metadata.name}')
kubectl exec -it $POD_NAME -- cat /app/backend/backend.py | head -20


#http://104.197.2.29:5000/


#If ag=fter chnages there is no chnages
kubectl logs -l app=planner -f              #Keep this running and try to submit the form. Do you see any requests coming in?
docker build -t planner:latest .      
minikube image load planner:latest         # if this stucks for build >>docker build --no-cache -t planner:latest .
# Delete the deployment
kubectl delete deployment planner

# Recreate it
kubectl apply -f k8s.yaml

# Wait for it to be ready
kubectl wait --for=condition=ready pod -l app=planner --timeout=60s
kubectl port-forward svc/planner-service 5000:80 --address 0.0.0.0


#if not working then update the code maybe previously the code did not get updated
# Point to minikube's Docker
eval $(minikube docker-env)
# Force complete rebuild
docker build --no-cache -t planner:latest .
# Switch back
eval $(minikube docker-env -u)
kubectl delete deployment planner
kubectl apply -f k8s.yaml
kubectl wait --for=condition=ready pod -l app=planner --timeout=60s
kubectl port-forward svc/planner-service 5000:80 --address 0.0.0.0
################################################################################




# install docker
# Add Docker's official GPG key:
sudo apt update
sudo apt install ca-certificates curl
sudo install -m 0755 -d /etc/apt/keyrings
sudo curl -fsSL https://download.docker.com/linux/ubuntu/gpg -o /etc/apt/keyrings/docker.asc
sudo chmod a+r /etc/apt/keyrings/docker.asc

# Add the repository to Apt sources:
sudo tee /etc/apt/sources.list.d/docker.sources <<EOF
Types: deb
URIs: https://download.docker.com/linux/ubuntu
Suites: $(. /etc/os-release && echo "${UBUNTU_CODENAME:-$VERSION_CODENAME}")
Components: stable
Signed-By: /etc/apt/keyrings/docker.asc
EOF

sudo apt update

 sudo apt install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin
 sudo docker run hello-world

#Post install
 sudo groupadd docker
 sudo usermod -aG docker $USER
 newgrp docker
 docker run hello-world
 sudo systemctl enable docker.service
 sudo systemctl enable containerd.service




# Install minikube
curl -LO https://github.com/kubernetes/minikube/releases/latest/download/minikube-linux-amd64
sudo install minikube-linux-amd64 /usr/local/bin/minikube && rm minikube-linux-amd64
minikube start


#Install kubectl
   curl -LO "https://dl.k8s.io/release/$(curl -L -s https://dl.k8s.io/release/stable.txt)/bin/linux/amd64/kubectl"

   sudo snap install kubectl --classic
kubectl version --client




###################################
AFter shutdown vm
1. Login to VM again
2. cd to the main repo
3. minikube start
4. minikube status
5. kubectl version --client   #to cross check
6. kubectl get nodes       
7. kubectl cluster-info    
8. docker ps 
9. docker network ls
10. docker ps  
11. docker logs jenkins   
if log shows stopped 2026-01-21 07:55:09.208+0000 [id=35]    INFO    jenkins.model.Jenkins#_cleanUpAwaitDisconnects: Waiting for node disconnection completion
2026-01-21 07:55:09.209+0000 [id=35]    INFO    hudson.lifecycle.Lifecycle#onStatusUpdate: Jenkins stopped
simple restart jenkins dont do step 12 do step 13
12. docker run -d --name jenkins \
    -p 8080:8080 \
    -p 50000:50000 \
    -v /var/run/docker.sock:/var/run/docker.sock \
    -v $(which docker):/usr/bin/docker \
    -u root \
    -e DOCKER_GID=$(getent group docker | cut -d: -f3) \
    --network minikube \
    jenkins/jenkins:lts


    # if jenkins is not active    

13. docker restart jenkins  
14. If jenin is slow
docker stop jenkins
docker rm jenkins    
docker run -d --name jenkins \
    -p 8080:8080 \
    -p 50000:50000 \
    -v /var/run/docker.sock:/var/run/docker.sock \
    -v $(which docker):/usr/bin/docker \
    -u root \
    -e DOCKER_GID=$(getent group docker | cut -d: -f3) \
    --network minikube \
    jenkins/jenkins:lts 
docker logs jenkins -f



#https://claude.ai/chat/be8d2e38-bd76-4fdd-bdb7-516672ccf583
Note: Jenkin with persistance volume. This is useful if you remove Jenkins be mistak then when you reinstall you have your Jenkins backup data (jobs, configurations, credentials, plugins, etc.).

# Stop and remove current Jenkins
docker stop jenkins
docker rm jenkins

# Create a directory on your VM for Jenkins data
mkdir -p ~/jenkins_data
sudo chown -R 1000:1000 ~/jenkins_data

# Run Jenkins with host directory mount
docker run -d --name jenkins \
  -p 8080:8080 \
  -p 50000:50000 \
  -v ~/jenkins_data:/var/jenkins_home \
  -v /var/run/docker.sock:/var/run/docker.sock \
  -v $(which docker):/usr/bin/docker \
  -u root \
  -e DOCKER_GID=$(getent group docker | cut -d: -f3) \
  -e JAVA_OPTS="-Xmx2048m -Xms1024m" \
  --network minikube \
  --restart unless-stopped \
  jenkins/jenkins:lts

# Monitor startup
docker logs jenkins -f


or 

# Stop and remove current Jenkins
docker stop jenkins
docker rm jenkins

# Create a named volume for persistence
docker volume create jenkins_home

# Run Jenkins with persistent storage
docker run -d --name jenkins \
  -p 8080:8080 \
  -p 50000:50000 \
  -v jenkins_home:/var/jenkins_home \
  -v /var/run/docker.sock:/var/run/docker.sock \
  -v $(which docker):/usr/bin/docker \
  -u root \
  -e DOCKER_GID=$(getent group docker | cut -d: -f3) \
  -e JAVA_OPTS="-Xmx2048m -Xms1024m" \
  --network minikube \
  --restart unless-stopped \
  jenkins/jenkins:lts

# Monitor startup
docker logs jenkins -f

Note: Important Rules
✅ DO: Stop and remove containers anytime - your data stays in the volume/directory
❌ DON'T: Delete the volume or directory:

docker volume rm jenkins_home ← This deletes all data!
rm -rf ~/jenkins_data ← This deletes all data!

#Re run   
docker stop jenkins
docker rm jenkins
docker run -d --name jenkins \
     -p 8080:8080 \
     -p 50000:50000 \
     -v jenkins_home:/var/jenkins_home \
     -v /var/run/docker.sock:/var/run/docker.sock \
     -v $(which docker):/usr/bin/docker \
     -u root \
     -e DOCKER_GID=$(getent group docker | cut -d: -f3) \
     -e JAVA_OPTS="-Xmx2048m -Xms1024m" \
     --network minikube \
     --restart unless-stopped \
     jenkins/jenkins:lts